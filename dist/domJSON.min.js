"use strict";var domJSON={},metadata={href:window.location.href||null,userAgent:window.navigator&&window.navigator.userAgent?window.navigator.userAgent:null,version:"0.1.2"},defaultsForToJSON={absolutePaths:["action","data","href","src"],attributes:!0,computedStyle:!1,cull:!0,deep:!0,domProperties:!0,filter:!1,htmlOnly:!1,metadata:!0,serialProperties:!1,stringify:!1,allowDangerousElements:!1},defaultsForToDOM={noMeta:!1,allowDangerousElements:!1},banned=["link","script"],required=["nodeType","nodeValue","tagName"],ignored=["attributes","childNodes","children","classList","dataset","style"],serials=["innerHTML","innerText","outerHTML","outerText","prefix","text","textContent","wholeText"],extend=function(e){if(!arguments.length)return arguments[0]||{};for(var t in arguments[1])e[t]=arguments[1][t];if(arguments.length>2){var r=[e].concat(Array.prototype.slice.call(arguments,2));return extend.apply(null,r)}return e},unique=function(){if(!arguments.length)return[];for(var e=Array.prototype.concat.apply([],arguments),t=0;t<e.length;t++)e.indexOf(e[t])<t&&(e.splice(t,1),t--);return e},copy=function(e){if(e instanceof Array)return e.slice();var t={};for(var r in e)t[r]=e[r];return t},boolInter=function(e,t){var r;if(e instanceof Array)r=unique(e.filter(function(e){return t.indexOf(e)>-1}));else{r={};for(var n in t)e.hasOwnProperty(t[n])&&(r[t[n]]=e[t[n]])}return r},boolDiff=function(e,t){var r;if(e instanceof Array)r=unique(e.filter(function(e){return-1===t.indexOf(e)}));else{r={};for(var n in e)r[n]=e[n];for(var o in t)r.hasOwnProperty(t[o])&&delete r[t[o]]}return r},boolFilter=function(e,t){return t===!1?e instanceof Array?[]:{}:t instanceof Array&&t.length?"boolean"==typeof t[0]?1==t.length&&"boolean"==typeof t[0]?t[0]===!0?copy(e):e instanceof Array?[]:{}:t[0]===!0?boolDiff(e,t.slice(1)):boolInter(e,t.slice(1)):boolInter(e,t):copy(e)},toShorthand=function(e){var t;return"boolean"==typeof e?e:"object"==typeof e&&null!==e?e instanceof Array?e.filter(function(e,t){return"string"==typeof e||0===t&&e===!0?!0:!1}):e.values instanceof Array?(t=e.values.filter(function(e){return"string"==typeof e?!0:!1}),t.length?(e.exclude&&t.unshift(e.exclude),t):!1):!1:e?!0:!1},toAbsolute=function(e,t){var r,n,o;if(e.match(/(?:^data\:|^[\w\-\+\.]*?\:\/\/|^\/\/)/i))return e;if("/"===e.charAt(0))return t+e.substr(1);r=t.indexOf("://")>-1?t.substring(0,t.indexOf("://")+3):"",n=(r.length?t.substring(r.length):t).split("/"),o=e.split("/"),n.pop();for(var a=0;a<o.length;a++)"."!=o[a]&&(".."==o[a]?n.length>1&&n.pop():n.push(o[a]));return r+n.join("/")},copyJSON=function(e,t){var r={};for(var n in e){try{e[n]}catch(o){continue}"undefined"!=typeof e[n]&&"function"!=typeof e[n]&&n.charAt(0).toLowerCase()===n.charAt(0)&&("object"!=typeof e[n]||e[n]instanceof Array)&&(t.cull?(e[n]||0===e[n]||e[n]===!1)&&(r[n]=e[n]):r[n]=e[n])}return r=boolFilter(r,t.domProperties)},attrJSON=function(e,t){for(var r,n={},o=e.attributes,a=o.length,i=0;a>i;i++)n[o[i].name]=o[i].value;n=t.attributes?boolFilter(n,t.attributes):null,r=boolFilter(n,t.absolutePaths);for(var i in r)n[i]=toAbsolute(r[i],t.absoluteBase);return n},styleJSON=function(e,t){var r,n={};if(!(t.computedStyle&&e.style instanceof CSSStyleDeclaration))return null;r=window.getComputedStyle(e);for(var o in r)"cssText"!==o&&!o.match(/\d/)&&"string"==typeof r[o]&&r[o].length&&(n[o]=r[o]);return t.computedStyle instanceof Array?boolFilter(n,t.computedStyle):n},toJSON=function(e,t,r){var n,o,a,i,s,l=copyJSON(e,t);if(1===e.nodeType){if(!t.allowDangerousElements)for(var u in banned)if(e.tagName.toLowerCase()===banned[u])return null}else if(3===e.nodeType&&!e.nodeValue.trim())return null;if(t.attributes&&e.attributes&&(l.attributes=attrJSON(e,t)),t.computedStyle&&(n=styleJSON(e,t))&&(l.style=n),t.deep===!0||"number"==typeof t.deep&&t.deep>r){s=[],o=t.htmlOnly?e.children:e.childNodes,a=o.length;for(var d=0;a>d;d++)i=toJSON(o[d],t,r+1),i&&s.push(i);l.childNodes=s}return l};domJSON.toJSON=function(e,t){var r,n={},o={},a=(new Date).getTime(),i=required.slice(),s=ignored.slice();return n=extend({},defaultsForToJSON,t),n.absolutePaths=toShorthand(n.absolutePaths),n.attributes=toShorthand(n.attributes),n.computedStyle=toShorthand(n.computedStyle),n.domProperties=toShorthand(n.domProperties),n.serialProperties=toShorthand(n.serialProperties),n.absoluteBase=window.location.origin+"/",n.serialProperties!==!0&&(s=s.concat(n.serialProperties instanceof Array&&n.serialProperties.length?n.serialProperties[0]===!0?boolDiff(serials,n.serialProperties):boolInter(serials,n.serialProperties):serials)),n.domProperties=n.domProperties instanceof Array?n.domProperties[0]===!0?boolDiff(unique(n.domProperties,s),i):boolDiff(unique(n.domProperties,i),s):n.domProperties===!1?i:[!0].concat(s),r=toJSON(e,n,0),n.metadata?(o.meta=extend({},metadata,{clock:(new Date).getTime()-a,date:(new Date).toISOString(),dimensions:{inner:{x:window.innerWidth,y:window.innerHeight},outer:{x:window.outerWidth,y:window.outerHeight}},options:n}),o.node=r):o=r,n.stringify?JSON.stringify(o):o};var createNode=function(e,t,r){switch(t instanceof DocumentFragment&&(t=t.ownerDocument),e){case 1:return"string"==typeof r.tagName?t.createElement(r.tagName):!1;case 3:return t.createTextNode("string"==typeof r.nodeValue&&r.nodeValue.length?r.nodeValue:"");case 7:return r.hasOwnProperty("target")&&r.hasOwnProperty("data")?t.createProcessingInstruction(r.target,r.data):!1;case 8:return t.createComment("string"==typeof r.nodeValue?r.nodeValue:"");case 9:return t.implementation.createHTMLDocument(r);case 11:return t;default:return!1}},toDOM=function(e,t,r,n){if(!e.nodeType)return!1;if(1===e.nodeType&&!n.allowDangerousElements)for(var o in banned)if(e.tagName.toLowerCase()===banned[o])return!1;var a=createNode(e.nodeType,r,e);t.appendChild(a);for(var i in e)if("object"!=typeof e[i]&&"isContentEditable"!==i&&"childNodes"!==i)try{a[i]=e[i]}catch(s){continue}if(1===e.nodeType&&e.tagName&&e.attributes)for(var l in e.attributes)a.setAttribute(l,e.attributes[l]);if(e.childNodes&&e.childNodes.length)for(var u in e.childNodes)toDOM(e.childNodes[u],a,r,n)};domJSON.toDOM=function(e,t){var r,n;return"string"==typeof e&&(e=JSON.parse(e)),r=extend({},defaultsForToDOM,t),n=document.createDocumentFragment(),r.noMeta?toDOM(e,n,n,r):toDOM(e.node,n,n,r),n},module.exports=domJSON;