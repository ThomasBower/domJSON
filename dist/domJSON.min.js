module.exports=function(){"use strict";var e={},t={href:window.location.href||null,userAgent:window.navigator&&window.navigator.userAgent?window.navigator.userAgent:null,version:"0.1.2"},r={absolutePaths:["action","data","href","src"],attributes:!0,computedStyle:!1,cull:!0,deep:!0,domProperties:!0,filter:!1,htmlOnly:!1,metadata:!0,serialProperties:!1,stringify:!1,allowDangerousElements:!1},n={noMeta:!1,allowDangerousElements:!1},o=["link","script"],a=["nodeType","nodeValue","tagName"],i=["attributes","childNodes","children","classList","dataset","style"],s=["innerHTML","innerText","outerHTML","outerText","prefix","text","textContent","wholeText"],u=function(e){if(!arguments.length)return arguments[0]||{};for(var t in arguments[1])e[t]=arguments[1][t];if(arguments.length>2){var r=[e].concat(Array.prototype.slice.call(arguments,2));return u.apply(null,r)}return e},l=function(){if(!arguments.length)return[];for(var e=Array.prototype.concat.apply([],arguments),t=0;t<e.length;t++)e.indexOf(e[t])<t&&(e.splice(t,1),t--);return e},c=function(e){if(e instanceof Array)return e.slice();var t={};for(var r in e)t[r]=e[r];return t},f=function(e,t){var r;if(e instanceof Array)r=l(e.filter(function(e){return t.indexOf(e)>-1}));else{r={};for(var n in t)e.hasOwnProperty(t[n])&&(r[t[n]]=e[t[n]])}return r},d=function(e,t){var r;if(e instanceof Array)r=l(e.filter(function(e){return-1===t.indexOf(e)}));else{r={};for(var n in e)r[n]=e[n];for(var o in t)r.hasOwnProperty(t[o])&&delete r[t[o]]}return r},p=function(e,t){return t===!1?e instanceof Array?[]:{}:t instanceof Array&&t.length?"boolean"==typeof t[0]?1==t.length&&"boolean"==typeof t[0]?t[0]===!0?c(e):e instanceof Array?[]:{}:t[0]===!0?d(e,t.slice(1)):f(e,t.slice(1)):f(e,t):c(e)},y=function(e){var t;return"boolean"==typeof e?e:"object"==typeof e&&null!==e?e instanceof Array?e.filter(function(e,t){return"string"==typeof e||0===t&&e===!0?!0:!1}):e.values instanceof Array?(t=e.values.filter(function(e){return"string"==typeof e?!0:!1}),t.length?(e.exclude&&t.unshift(e.exclude),t):!1):!1:e?!0:!1},g=function(e,t){var r,n,o;if(e.match(/(?:^data\:|^[\w\-\+\.]*?\:\/\/|^\/\/)/i))return e;if("/"===e.charAt(0))return t+e.substr(1);r=t.indexOf("://")>-1?t.substring(0,t.indexOf("://")+3):"",n=(r.length?t.substring(r.length):t).split("/"),o=e.split("/"),n.pop();for(var a=0;a<o.length;a++)"."!=o[a]&&(".."==o[a]?n.length>1&&n.pop():n.push(o[a]));return r+n.join("/")},m=function(e,t){var r={};for(var n in e){try{e[n]}catch(o){continue}"undefined"!=typeof e[n]&&"function"!=typeof e[n]&&n.charAt(0).toLowerCase()===n.charAt(0)&&("object"!=typeof e[n]||e[n]instanceof Array)&&(t.cull?(e[n]||0===e[n]||e[n]===!1)&&(r[n]=e[n]):r[n]=e[n])}return r=p(r,t.domProperties)},h=function(e,t){for(var r,n={},o=e.attributes,a=o.length,i=0;a>i;i++)n[o[i].name]=o[i].value;n=t.attributes?p(n,t.attributes):null,r=p(n,t.absolutePaths);for(var i in r)n[i]=g(r[i],t.absoluteBase);return n},v=function(e,t){var r,n={};if(!(t.computedStyle&&e.style instanceof CSSStyleDeclaration))return null;r=window.getComputedStyle(e);for(var o in r)"cssText"!==o&&!o.match(/\d/)&&"string"==typeof r[o]&&r[o].length&&(n[o]=r[o]);return t.computedStyle instanceof Array?p(n,t.computedStyle):n},w=function(e,t,r){var n,a,i,s,u,l=m(e,t);if(1===e.nodeType){if(!t.allowDangerousElements)for(var c in o)if(e.tagName.toLowerCase()===o[c])return null}else if(3===e.nodeType&&!e.nodeValue.trim())return null;if(t.attributes&&e.attributes&&(l.attributes=h(e,t)),t.computedStyle&&(n=v(e,t))&&(l.style=n),t.deep===!0||"number"==typeof t.deep&&t.deep>r){u=[],a=t.htmlOnly?e.children:e.childNodes,i=a.length;for(var f=0;i>f;f++)s=w(a[f],t,r+1),s&&u.push(s);l.childNodes=u}return l};e.toJSON=function(e,n){var o,c={},p={},g=(new Date).getTime(),m=a.slice(),h=i.slice();return c=u({},r,n),c.absolutePaths=y(c.absolutePaths),c.attributes=y(c.attributes),c.computedStyle=y(c.computedStyle),c.domProperties=y(c.domProperties),c.serialProperties=y(c.serialProperties),c.absoluteBase=window.location.origin+"/",c.serialProperties!==!0&&(h=h.concat(c.serialProperties instanceof Array&&c.serialProperties.length?c.serialProperties[0]===!0?d(s,c.serialProperties):f(s,c.serialProperties):s)),c.domProperties=c.domProperties instanceof Array?c.domProperties[0]===!0?d(l(c.domProperties,h),m):d(l(c.domProperties,m),h):c.domProperties===!1?m:[!0].concat(h),o=w(e,c,0),c.metadata?(p.meta=u({},t,{clock:(new Date).getTime()-g,date:(new Date).toISOString(),dimensions:{inner:{x:window.innerWidth,y:window.innerHeight},outer:{x:window.outerWidth,y:window.outerHeight}},options:c}),p.node=o):p=o,c.stringify?JSON.stringify(p):p};var b=function(e,t,r){switch(t instanceof DocumentFragment&&(t=t.ownerDocument),e){case 1:return"string"==typeof r.tagName?t.createElement(r.tagName):!1;case 3:return t.createTextNode("string"==typeof r.nodeValue&&r.nodeValue.length?r.nodeValue:"");case 7:return r.hasOwnProperty("target")&&r.hasOwnProperty("data")?t.createProcessingInstruction(r.target,r.data):!1;case 8:return t.createComment("string"==typeof r.nodeValue?r.nodeValue:"");case 9:return t.implementation.createHTMLDocument(r);case 11:return t;default:return!1}},P=function(e,t,r,n){if(!e.nodeType)return!1;if(1===e.nodeType&&!n.allowDangerousElements)for(var a in o)if(e.tagName.toLowerCase()===o[a])return!1;var i=b(e.nodeType,r,e);t.appendChild(i);for(var s in e)if("object"!=typeof e[s]&&"isContentEditable"!==s&&"childNodes"!==s)try{i[s]=e[s]}catch(u){continue}if(1===e.nodeType&&e.tagName&&e.attributes)for(var l in e.attributes)i.setAttribute(l,e.attributes[l]);if(e.childNodes&&e.childNodes.length)for(var c in e.childNodes)P(e.childNodes[c],i,r,n)};return e.toDOM=function(e,t){var r,o;return"string"==typeof e&&(e=JSON.parse(e)),r=u({},n,t),o=document.createDocumentFragment(),r.noMeta?P(e,o,o,r):P(e.node,o,o,r),o},e}();